name: Auto fetch SZVÖRs

       # Controls when the workflow will run
on:
  # Triggers the workflow every 5 minutes
  schedule:
    - cron: "0 14 * */1 *"
  workflow_dispatch:
     # A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "cron"
  cron:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
           - name: Setup Java JDK
             uses: actions/setup-java@v3.3.0
             with:
               # The Java version to set up. Takes a whole or semver Java version. See examples of supported syntax in README file
               java-version: 17
               # Java distribution. See the list of supported distributions in README file
               distribution: temurin
               # The package type (jdk, jre, jdk+fx, jre+fx)
               java-package: jre
             # Runs a single command using the runners shell
           - name: checkout code           
             uses: actions/checkout@v1
           
           - name: Get current date
             id: date
             run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
           - name: Install dependencies
             run: |
              apt update&&apt install wget curl -y
              wget "https://github.com/tabulapdf/tabula-java/releases/download/v1.0.5/tabula-1.0.5-jar-with-dependencies.jar"
           - name: Fetch szvör pdfs
             run: |
              wget -l 1 -A pdf --mirror https://www.mavcsoport.hu/mav-start/bemutatkozas/belfoldi-utazas/vonatosszeallitas-szvor
           - name: Extract csvs from the pdfs 
             run: |  
              java -jar tabula-1.0.5-jar-with-dependencies.jar -b www.mavcsoport.hu/sites/default/files/upload/page/ -f CSV -l -o csv 
           - name: Move extracted files
             run: |
               mkdir csv
               mv www.mavcsoport.hu/sites/default/files/upload/page/*.csv csv/
           - uses: actions/upload-artifact@v3
             with:
               name: szvor-${{ steps.date.outputs.date }}
               path: csv/
           - name: Verified commit
         # You may pin to the exact commit or the version.
         # uses: swinton/commit@bfa68d879ec57187f2c5bf616158433763f05f06
             uses: swinton/commit@v2.0.0
             with:
              files: csv/*.csv 
              commit-message: szvör update  ${{ steps.date.outputs.date }}
